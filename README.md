# PVE 一键优化脚本 v3.0 

此脚本旨在为 Proxmox VE (PVE) 用户提供一站式的系统优化、功能增强和维护工具。它集成了 CPU 性能调优、订阅弹窗去除、监控工具安装、电源模式预设以及便捷的回滚功能。

## 功能特性

1.  **CPU 性能与调频优化**:
    *   配置 CPU 调速器 (Governor)，支持高性能、节能、按需、调度优化等多种模式。
    *   手动设置 CPU 最小/最大频率。
    *   Intel CPU 深度控制 (P-State/睿频)，支持 Active/Passive/Off 模式切换，以及睿频加速的开启/关闭。
    *   一键优化虚拟机 CPU 为 `host` 模式。
2.  **去除网页“无有效订阅”弹窗**: 移除 PVE 网页界面中的订阅提示弹窗。
3.  **安装全套监控工具**: 提供 `lm-sensors`, `smartmontools`, `powertop`, `nvme-cli`, `hddtemp`, `netdata`, `stress-ng` 等常用监控和诊断工具的安装选项。
4.  **电源工作模式一键预设**: 快速切换服务器、家用平衡和极致节能三种电源方案。
5.  **查看当前系统运行状态**: 实时显示 PVE 版本、CPU 型号、当前频率、调速模式、内存使用和磁盘空间等信息。
6.  **一键回滚脚本所做的修改**: 自动备份修改过的文件，并提供一键回滚功能，撤销脚本对系统的更改。

## 使用方法

1.  **下载脚本**:
    将 `pve.sh` 文件下载到您的 PVE 服务器上。

2.  **赋予执行权限**:
    ```bash
    chmod +x pve.sh
    ```

3.  **运行脚本**:
    ```bash
    ./pve.sh
    ```
    脚本将以交互式菜单的形式引导您完成各项优化操作。在执行任何修改前，脚本会自动备份相关文件。

4.  **根据菜单提示操作**:
    *   首次运行会提示是否开始优化，选择“是”进入主菜单。
    *   主菜单包含所有主要功能，您可以根据需求选择对应的数字选项。
    *   部分功能 (如 CPU 优化) 含有子菜单，可以进一步细化设置。
    *   “一键回滚”功能可以撤销脚本在当前运行周期内所做的修改。

## 注意事项

*   脚本需要 `root` 权限运行。
*   部分功能可能需要重启 PVE 或虚拟机才能完全生效。
*   建议在执行重要操作前手动备份您的 PVE 系统。
*   “去除网页‘无有效订阅’弹窗”功能修改后，请在浏览器中按 `Ctrl+F5` 刷新页面以查看效果。
*   安装 `netdata` 时，脚本会从 `my-netdata.io` 下载并执行安装脚本。

希望这份使用方法对您有帮助！